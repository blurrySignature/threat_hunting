# Сбор и аналитическая обработка информации о сетевом трафике

## Цель работы

1. Развить практические навыки использования современного стека инструментов сбора и аналитической обработки информации о сетвом трафике
2. Освоить базовые подходы блокировки нежелательного сетевого трафика
3. Закрепить знания о современных сетевых протоколах прикладного уровня

## ️Исходные данные

1. ОС Windows 11
2. Virtual Box с ОС Kali Linux
3. Сетевой анализатор - Wireshark
4. Утилита Zeek для анализа трафика
5. Python 3.9

## ️Задание

1. Собрать сетевой трафик (объемом не менее 100 Мб)
2. Выделить метаинформацию сетевого трафика с помощью утилиты Zeek
3. Собрать данные об источниках нежелательного трафика, например – https://github.com/StevenBlack
4. Написать программу на любом удобном языке (python, bash, R …), которая подсчитывает процент нежелательного трафика в собранном на этапе 1.
5. Оформить отчет в соответствии с шаблоном

## Содержание ЛР

### Шаг 1

Для подсчёта _%_ нежелательного трафика, полазим по подозрительным сайтам, переходя по рекламным 
баннерам и незащищённым ссылкам. Для этого на виртуальной машине запустим Wireshark, начнём захват трафик, и, когда
его объём будет ___> 100 МБ___, приостановим захват и сохраним файл .pcapng

![image](https://user-images.githubusercontent.com/95019919/226957914-5d5db1db-4851-4927-9bb0-ab8560347639.png)

### Шаг 2

1. Выделим и помести в папку data метаинформацию сетевого трафика с помощью утилиты Zeek:
zeek –C –r my_traffic.pcapng

2. Вычленим адреса из dns.log:
awk '/^[^#]/ {print $10}' dns.log >> dns

Полученные файлы:

![image](https://user-images.githubusercontent.com/95019919/226958319-c2036cff-fd90-4174-87ee-428e0e94d875.png)

### Шаг 3

1. Соберём данные об источниках нежелательного трафика. Воспользуемся открытым репозиторием 
с GitHub – https://github.com/StevenBlack
2. С репозитория взяты несколько файлов и объединены в один с помощью команды
```
cat hosts2 >> hosts
```
3. Затем извлечём только доменные имена из **hosts**:
```
cat hosts | cut -d " " -f2 >> hosts
```

### Шаг 4

Напишем программу на языке Python, которая подсчитывает процент нежелательного трафика, собранного на Шаге 1:

Исходный код:
```python
def main():
    with open('dns', 'r') as dns_file, open('hosts', 'r') as hosts_file:
        dns_lines = dns_file.readlines()
        dns_lines = [line.strip() for line in dns_lines if line.strip() and line.strip() != "-"]
        hosts_lines = hosts_file.readlines()
        hosts_lines = [line.strip() for line in hosts_lines if
                       line.strip() and line.strip() != "-" and line.strip() != "#"]
        dns_set = set(dns_lines)
        hosts_set = set(hosts_lines)
        common_lines = dns_set.intersection(hosts_set)

    dns_count = len(dns_lines)
    common_count = len(common_lines)
    percent = round(common_count / dns_count * 100, 1)
    print(f'Процент нежелательного трафика: {percent}%')


if __name__ == '__main__':
    main()

```
Результат выполнения кода:

![image](https://user-images.githubusercontent.com/95019919/226958563-50bb0fa6-85e2-4776-8f9b-a34909f2a8a1.png)

## ️Оценка результата

В ходе практического задания:
+ собрано 147 Мб сетевого трафика
+ собраны данные об источниках нежелательного трафика
+ проведено их сравнение, найдены нежелательные dns адреса
+ подсчитан процент нежелательного трафика (2.7%)

## ️Вывод 

В результате выполнения лабораторной работы были изучены инструменты сетевого анализа, извлечение 
необходимой информации о dns адресах с помощью Zeek, а также проведено сравнение и анализ нежелательного трафика.
